<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Bogot√° Tranquila</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* ------------------- */
    /* Reset & Base Styles */
    /* ------------------- */
    :root {
      --primary-light: #4fc3f7;
      --primary-dark: #29b6f6;
      --secondary-light: #aed581;
      --secondary-dark: #9ccc65;
      --danger-light: #ef5350;
      --danger-dark: #d32f2f;
      --warning: #f39c12;
      --text-dark: #34495e;
      --text-light: #7f8c8d;
      --bg-main: #f0f4f8;
      --bg-light: #ffffff;
      --border-color: #e0f7fa;
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    body {
      font-family: 'Inter', sans-serif;
      background: #d1e9f9;
      color: var(--text-dark);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 10px;
    }

    /* ------------------- */
    /* Main App Container  */
    /* ------------------- */
    .app-container {
      width: 100%;
      max-width: 400px;
      height: 85vh;
      max-height: 850px;
      background: var(--bg-main);
      border-radius: 30px;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
      overflow: hidden;
      display: flex; 
      flex-direction: column;
      border: 1px solid rgba(255, 255, 255, 0.2);
      position: relative;
    }
    
    /* Screen Styling */
    .screen {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      padding: 25px 20px 80px 20px; /* Padding bottom for nav bar */
      display: none; /* Changed from flex to none */
      flex-direction: column;
      overflow-y: auto;
      background-color: var(--bg-main);
      transition: opacity 0.3s ease-in-out;
      z-index: 1;
    }
    .screen.active {
      display: flex; /* Use flex to show */
      opacity: 1;
      visibility: visible;
      z-index: 2;
    }
    
    /* ------------------- */
    /* Generic Components  */
    /* ------------------- */
    .header {
      font-size: 1.8em;
      font-weight: 700;
      margin-bottom: 20px;
      text-align: center;
      color: var(--text-dark);
    }
    .logo-img {
       width: 150px;
        height: auto;
        margin: 0 auto 12px;
        display: block;
    }
    input[type="email"], input[type="password"], input[type="text"], input[type="date"] {
      width: 100%;
      padding: 15px;
      border: 1px solid var(--border-color);
      border-radius: 12px;
      font-size: 1em;
      background: var(--bg-light);
      color: var(--text-dark);
      margin-bottom: 16px;
      transition: all .3s;
    }
    input:focus {
      outline: none;
      border-color: var(--primary-dark);
      box-shadow: 0 0 8px rgba(41, 182, 246, 0.3);
    }
    .button, button {
      background: linear-gradient(135deg, var(--primary-light), var(--primary-dark));
      color: #fff;
      border: none;
      padding: 15px;
      border-radius: 12px;
      font-size: 1em;
      font-weight: 600;
      cursor: pointer;
      transition: all .2s;
      width: 100%;
      margin: 8px 0;
      box-shadow: 0 4px 15px rgba(41, 182, 246, 0.25);
      text-transform: uppercase;
    }
    button:disabled {
        background: #bdc3c7;
        box-shadow: none;
        cursor: not-allowed;
    }
    button:hover, .button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(41, 182, 246, 0.3);
    }
    .button.secondary {
      background: linear-gradient(135deg, var(--secondary-light), var(--secondary-dark));
      box-shadow: 0 4px 15px rgba(154, 206, 101, 0.25);
    }
    .button.tertiary {
      background: none;
      border: 2px solid var(--primary-dark);
      color: var(--primary-dark);
      box-shadow: none;
    }

    /* --- Checkbox styles for T&C --- */
    .consent-group {
        text-align: left;
        margin: 10px 0 20px 0;
        font-size: 0.9em;
        color: var(--text-dark);
    }
    .consent-group label {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
    }
    .consent-group input[type="checkbox"] {
        width: auto;
        margin: 0 10px 0 0;
    }
    .consent-group a {
        color: var(--primary-dark);
        text-decoration: none;
        font-weight: 600;
    }

    /* ------------------- */
    /* Navigation          */
    /* ------------------- */
    .bottom-nav {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      display: flex;
      justify-content: space-around;
      padding: 10px 0;
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(10px);
      border-top: 1px solid var(--border-color);
      z-index: 100;
    }
    .nav-item {
      text-align: center;
      color: var(--text-light);
      font-size: .75em;
      cursor: pointer;
      transition: color .3s;
      flex: 1;
      padding: 5px 0;
    }
    .nav-item.active {
      color: var(--primary-dark);
      font-weight: 600;
    }
    .nav-icon {
      display: block;
      font-size: 1.6em;
      margin-bottom: 2px;
    }

    /* ------------------- */
    /* Specific Screens    */
    /* ------------------- */

    /* Login Screen */
    #loginScreen, #registerScreen {
      justify-content: center;
      padding-bottom: 25px;
	  background-color:white;
    }
    #loginScreen .header, #registerScreen .header {
        margin-top: auto; /* Push content to center */
    }
    #loginScreen > *, #registerScreen > * {
        flex-shrink: 0;
    }
    #loginScreen .button, #registerScreen .button {
        margin-bottom: auto; /* Push buttons down */
    }

    /* Legal Screen (T&C, Privacy) */
    #legalScreen .header-container {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 20px;
        flex-shrink: 0;
    }
    #legalScreen .back-button {
        background: none;
        border: none;
        font-size: 1.5em;
        color: var(--text-dark);
        cursor: pointer;
        padding: 0;
        margin: 0;
        width: auto;
        box-shadow: none;
    }
    #legalScreen h2 {
        font-size: 1.2em;
        text-align: center;
        flex-grow: 1;
    }
    #legalScreen .legal-content {
        font-size: 0.9em;
        line-height: 1.6;
        color: var(--text-light);
    }
     #legalScreen .legal-content h3 {
        margin-top: 20px;
        margin-bottom: 10px;
        color: var(--text-dark);
     }
    
    /* Dashboard Screen */
    .status-card {
      background: var(--bg-light);
      border: 1px solid var(--border-color);
      padding: 20px;
      border-radius: 20px;
      text-align: center;
      margin-bottom: 20px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.05);
    }
    .status-indicator {
      font-size: 2em;
      margin-bottom: 10px;
    }
    .heartbeat-monitor {
      display: inline-flex;
      align-items: center;
      background: rgba(231, 76, 60, 0.08);
      padding: 8px 15px;
      border-radius: 20px;
      margin-top: 10px;
    }
    .heartbeat-icon {
      color: #e74c3c;
      font-size: 1.2em;
      margin-right: 8px;
      animation: heartbeat 1.5s ease-in-out infinite;
    }
    @keyframes heartbeat {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }
    .smart-recommendation {
      background: var(--bg-light);
      border: 1px solid var(--border-color);
      padding: 20px;
      border-radius: 20px;
      margin-bottom: 18px;
      display: flex;
      align-items: center;
      gap: 15px;
    }
    .ai-icon {
      flex-shrink: 0;
      width: 45px;
      height: 45px;
      background: linear-gradient(135deg, var(--primary-light), var(--primary-dark));
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      font-size: 1.2em;
    }
    .quick-actions {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-top: 20px;
    }
    .quick-action-btn {
      background: var(--bg-light);
      color: var(--text-dark);
      border: 1px solid var(--border-color);
      padding: 16px 12px;
      border-radius: 16px;
      font-size: .9em;
      font-weight: 600;
      text-align: center;
      transition: all .3s;
      cursor: pointer;
    }
    .quick-action-btn:hover {
      background: #e3f2fd;
      border-color: var(--primary-dark);
      transform: translateY(-2px);
    }
    .quick-action-btn span {
      display: block;
      font-size: 1.5em;
      margin-bottom: 8px;
    }

    /* En Viaje Screen */
    .fab-sos {
      position: absolute;
      bottom: 90px;
      right: 20px;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--danger-light), var(--danger-dark));
      box-shadow: 0 4px 15px rgba(239, 83, 80, 0.4);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-weight: bold;
      z-index: 1000;
      border: none;
      font-size: 1.1em;
      animation: pulse 1.8s infinite;
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); box-shadow: 0 4px 15px rgba(239, 83, 80, 0.4); }
      50% { transform: scale(1.08); box-shadow: 0 8px 25px rgba(239, 83, 80, 0.6); }
    }
    .map-placeholder {
      background: var(--bg-light);
      border-radius: 16px;
      margin: 20px 0;
      border: 1px solid var(--border-color);
      overflow: hidden;
    }
    .map-placeholder img {
      width: 100%;
      height: auto;
      display: block;
    }
    .map-placeholder p {
      padding: 15px;
      text-align: center;
      font-weight: 500;
      color: var(--text-dark);
    }
    
    /* SOS Screen */
    .sos-btn {
      border: none;
      color: white;
      font-weight: 600;
      padding: 16px;
      font-size: 1em;
      border-radius: 16px;
      width: 100%;
      margin-bottom: 12px;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      text-align: left;
      display: flex;
      align-items: center;
    }
    .sos-btn span { font-size: 1.5em; margin-right: 15px; }
    .sos-call { background: linear-gradient(to right, #e53935, var(--danger-dark)); }
    .sos-record { background: linear-gradient(to right, #f57c00, #ef6c00); }
    .sos-location { background: linear-gradient(to right, #8e24aa, #7b1fa2); }
    .sos-hospital { background: linear-gradient(to right, var(--primary-light), var(--primary-dark)); }
    .sos-cancel { background: #b0bec5; color: #263238; margin-top: 20px;}

    /* Recursos Screen */
    .resource-list { list-style: none; }
    .resource-item {
      display: flex;
      align-items: center;
      background: var(--bg-light);
      border-radius: 12px;
      padding: 14px 16px;
      margin-bottom: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    }
    .resource-icon { font-size: 1.5em; margin-right: 15px; }
    .resource-item .info { flex-grow: 1; }
    .resource-item .info strong { font-size: 1em; color: var(--text-dark); }
    .resource-item .info small { font-size: 0.8em; color: var(--text-light); margin-top: 4px; }
    .resource-item .actions { display: flex; align-items: center; gap: 8px; }
    .resource-item .play-btn { background: none; border: none; font-size: 1.8em; cursor: pointer; color: var(--primary-dark); }
    .premium-badge { background: var(--warning); color: #fff; font-size: 0.7em; padding: 3px 8px; border-radius: 8px; margin-left: 8px; }

    /* Perfil Screen */
    .profile-avatar {
      width: 90px; height: 90px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary-light), var(--primary-dark));
      margin: 0 auto 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.5em;
      font-weight: bold;
      color: #fff;
      border: 4px solid var(--bg-light);
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    /* ------------------- */
    /* Chat/Asistente      */
    /* ------------------- */
    #chatScreen {
      padding: 0;
    }
    .chat-header {
        padding: 15px 20px;
        background: var(--bg-light);
        border-bottom: 1px solid var(--border-color);
        text-align: center;
        font-size: 1.2em;
        font-weight: 600;
        z-index: 5;
        flex-shrink: 0;
    }
    .chat-messages {
      flex-grow: 1;
      overflow-y: auto;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .chat-message {
      max-width: 80%;
      padding: 10px 15px;
      border-radius: 18px;
      font-size: 0.95em;
      line-height: 1.4;
      word-wrap: break-word;
    }
    .user-message {
      background-color: var(--primary-dark);
      color: white;
      border-bottom-right-radius: 4px;
      align-self: flex-end;
    }
    .bot-message {
      background-color: var(--bg-light);
      color: var(--text-dark);
      border: 1px solid var(--border-color);
      border-bottom-left-radius: 4px;
      align-self: flex-start;
    }
    .bot-message.typing {
        color: var(--text-light);
        font-style: italic;
    }
    .chat-input-area {
      display: flex;
      padding: 10px;
      border-top: 1px solid var(--border-color);
      background: var(--bg-light);
      align-items: center;
      flex-shrink: 0;
    }
    #chatInput {
      flex-grow: 1;
      border-radius: 20px;
      margin: 0;
    }
    .chat-button {
        background: none;
        border: none;
        color: var(--primary-dark);
        font-size: 1.5em;
        cursor: pointer;
        padding: 5px 10px;
        margin: 0;
        box-shadow: none;
    }
    #sendButton {
      color: var(--primary-dark);
    }
    #micButton {
        color: var(--text-light);
    }


/* === PRIVACY MANAGEMENT STYLES (NUEVO) ======= */
    .privacy-management-section {
        background: var(--bg-light);
        border-radius: 16px;
        padding: 5px 20px 20px 20px;
        margin-top: 20px;
        border: 1px solid var(--border-color);
    }
    .privacy-management-section h4 {
        text-align: center;
        padding: 15px 0;
        font-size: 1.1em;
    }
    .setting-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 0;
        border-bottom: 1px solid var(--border-color);
    }
    .setting-item:last-of-type { /* Use last-of-type for better targeting */
        border-bottom: none;
    }
    .setting-item .info {
        flex-grow: 1;
        text-align: left;
        margin-right: 15px;
    }
    .setting-item strong {
        font-size: 0.95em;
        color: var(--text-dark);
    }
    .setting-item small {
        font-size: 0.8em;
        color: var(--text-light);
        display: block;
        margin-top: 3px;
    }
    .toggle-switch {
        position: relative;
        display: inline-block;
        width: 50px;
        height: 28px;
        flex-shrink: 0;
    }
    .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }
    .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: .4s;
        border-radius: 28px;
    }
    .slider:before {
        position: absolute;
        content: "";
        height: 20px;
        width: 20px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: .4s;
        border-radius: 50%;
    }
    input:checked + .slider {
        background-color: var(--secondary-dark);
    }
    input:checked + .slider:before {
        transform: translateX(22px);
    }

    /* ------------------- */
    /* MODAL STYLES        */
    /* ------------------- */
    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6);
        display: none; 
        justify-content: center;
        align-items: center;
        z-index: 2000;
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    .modal-overlay.active {
        display: flex;
        opacity: 1;
    }
    .modal-content {
        background: white;
        padding: 30px;
        border-radius: 20px;
        width: 90%;
        max-width: 340px;
        text-align: center;
        transform: scale(0.9);
        transition: transform 0.3s ease;
    }
    .modal-overlay.active .modal-content {
        transform: scale(1);
    }
    .modal-content h3 {
        margin-bottom: 15px;
        color: var(--text-dark);
    }
    .modal-content p {
        margin-bottom: 25px;
        color: var(--text-light);
        line-height: 1.5;
    }
  </style>
</head>
<body>

  <div class="app-container">

    <div id="loginScreen" class="screen active">
      <img src="logo-bogota-tranquila.png" alt="Logo Bogot√° Tranquila" class="logo-img">
      <div class="header">Bogot√° Tranquila</div>
      <p style="text-align:center;color:var(--text-light);margin:-10px 0 30px;">Asistente para el Bienestar Urbano</p>
      <input type="email" id="email" placeholder="Correo Electr√≥nico" value="usuario@email.com">
      <input type="password" id="password" placeholder="Contrase√±a" value="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
      <button onclick="login()">INGRESAR</button>
      <button class="button secondary" onclick="navigateTo('registerScreen')">CREAR CUENTA</button>
      <p style="text-align:center;font-size:.9em;margin-top:20px;"><a href="#" onclick="showModal('Restablecer Contrase√±a', 'Se ha enviado un enlace para restablecer tu contrase√±a a tu correo electr√≥nico.')" style="color:var(--primary-dark);text-decoration:none;">¬øOlvidaste tu contrase√±a?</a></p>
    </div>

    <div id="registerScreen" class="screen">
        <div class="header">Crear Cuenta</div>
        <p style="text-align:center;color:var(--text-light);margin:-10px 0 30px;">Reg√≠strate para comenzar a mejorar tu bienestar.</p>
        <input type="email" id="registerEmail" placeholder="Correo Electr√≥nico">
        <input type="password" id="registerPassword" placeholder="Crear Contrase√±a">
        
        <label for="birthdate" style="font-size:0.9em; color:var(--text-light); text-align:left; width:100%; margin-bottom:5px;">Fecha de Nacimiento</label>
        <input type="date" id="birthdate">

        <div class="consent-group">
            <label>
                <input type="checkbox" id="acceptTerms">
                <span>He le√≠do y acepto los <a href="#" onclick="showLegal('terms')">T√©rminos y Condiciones</a>.</span>
            </label>
            <label>
                <input type="checkbox" id="acceptPrivacy">
                <span>Comprendo y acepto la <a href="#" onclick="showLegal('privacy')">Pol√≠tica de Privacidad y Manejo de Datos</a>.</span>
            </label>
        </div>

        <button onclick="createAccount()">CREAR CUENTA</button>
        <button class="button tertiary" onclick="navigateTo('loginScreen')">YA TENGO CUENTA</button>
    </div>

    <div id="legalScreen" class="screen">
        <div class="header-container">
            <button class="back-button" onclick="navigateTo('registerScreen')">‚Üê</button>
            <h2 id="legalTitle"></h2>
        </div>
        <div class="legal-content" id="legalContent">
            </div>
    </div>


    <div id="dashboardScreen" class="screen">
      <div class="header" style="text-align: left;">¬°Hola, <span id="userName">Usuario</span>!</div>
      <div class="status-card">
        <div class="status-indicator">üòå</div>
        <div style="font-size: 1.1em; font-weight: 600; color: #27ae60;">Estado: Tranquilo</div>
        <div class="heartbeat-monitor">
          <span class="heartbeat-icon">‚ù§Ô∏è</span>
          <span>72 BPM - Normal</span>
        </div>
      </div>
      
      <div class="smart-recommendation">
        <div class="ai-icon">IA</div>
        <div>
          <strong style="color: var(--text-dark);">Sugerencia del d√≠a</strong>
          <div style="font-size: 0.9em; color: var(--text-light); margin-top: 4px;">Detectamos tr√°fico ligero en tu ruta habitual. Es un buen momento para un viaje sin estr√©s.</div>
        </div>
      </div>
      <button class="button tertiary" onclick="navigateTo('chatScreen')">üí¨ HABLAR CON EL ASISTENTE</button>
      <button onclick="navigateTo('enViajeScreen')">üöó INICIAR VIAJE SEGURO</button>
      <div class="quick-actions">
        <button class="quick-action-btn" onclick="showModal('Respiraci√≥n Guiada', 'Iniciando ejercicio de respiraci√≥n de 2 minutos para calmar la mente.')"><span>ü´Å</span>Respiraci√≥n</button>
        <button class="quick-action-btn" onclick="showModal('M√∫sica Relajante', 'Reproduciendo tu playlist de m√∫sica para la concentraci√≥n.')"><span>üéµ</span>M√∫sica</button>
        <button class="quick-action-btn" onclick="navigateTo('recursosScreen')"><span>üìö</span>Recursos</button>
        <button class="quick-action-btn" onclick="showModal('En Desarrollo', 'Tu historial de bienestar estar√° disponible pronto.')"><span>üìä</span>Historial</button>
      </div>
    </div>

    <div id="enViajeScreen" class="screen">
      <div class="header">Viaje en Progreso</div>
      <div class="status-card" style="margin-bottom:20px; text-align: left;">
        <strong style="font-size: 1.2em;">Casa ‚Üí Oficina</strong>
        <p style="font-size:0.9em; color:var(--text-light); margin-top: 8px;">
          <span style="color: #27ae60; font-weight:600;">En ruta</span><br>
          ‚è±Ô∏è Tiempo estimado: 28 min<br>
          üìç Av. Caracas ‚Äì Tr√°fico moderado
        </p>
      </div>
      <div class="map-placeholder">
        <img src="https://placehold.co/600x400/EFEFEF/333333?text=Mapa+GPS+Inteligente" alt="Mapa de la ruta">
        <p>Rutas optimizadas para tu bienestar</p>
      </div>
      <button onclick="showModal('Finalizar Viaje', '¬°Buen viaje! Hemos guardado los datos de tu recorrido.')">‚úÖ FINALIZAR VIAJE</button>
      <button class="fab-sos" onclick="navigateTo('sosScreen')">SOS</button>
    </div>

    <div id="sosScreen" class="screen">
      <div class="header" style="color:var(--danger-light);">üö® Alerta de Emergencia</div>
      <div style="background:rgba(239,83,80,0.1);padding:20px;border-radius:16px;text-align:center;margin-bottom:24px;">
        <div style="font-size:3em;margin-bottom:12px;">üÜò</div>
        <p style="font-size:1.1em;font-weight:600;margin-bottom:8px;color:var(--text-dark);">¬øNecesitas ayuda urgente?</p>
        <p style="font-size:0.9em;color:var(--text-light);">Tu ubicaci√≥n y datos ser√°n compartidos con los servicios de emergencia y tus contactos de confianza.</p>
      </div>
      <button class="sos-btn sos-call" onclick="showModal('Llamando...', 'Conectando con la l√≠nea de emergencias 123.')"><span>üìû</span>LLAMAR EMERGENCIAS (123)</button>
      <button class="sos-btn sos-record" onclick="showModal('Grabando...', 'Iniciando grabaci√≥n de audio y video. Los archivos se guardar√°n de forma segura.')"><span>üé•</span>GRABAR EVIDENCIA</button>
      <button class="sos-btn sos-location" onclick="showModal('Ubicaci√≥n Compartida', 'Tu ubicaci√≥n en tiempo real ha sido enviada a tus contactos de emergencia.')"><span>üìç</span>COMPARTIR UBICACI√ìN</button>
      <button class="sos-btn sos-hospital" onclick="navigateTo('sugerenciaHospitalScreen')"><span>üè•</span>HOSPITAL RECOMENDADO</button>
      <button class="sos-btn sos-cancel" onclick="navigateTo('dashboardScreen')"><span>‚ùå</span>CANCELAR</button>
    </div>

    <div id="sugerenciaHospitalScreen" class="screen">
        <div class="header">Sugerencia de Atenci√≥n</div>
        <div style="text-align: center; margin-bottom: 20px;">
            <img src="https://placehold.co/120x60/00338d/ffffff?text=Allianz" alt="Logo Aseguradora" style="border-radius: 8px;">
            <p style="color: var(--text-light); font-size: 0.85em; margin-top: 10px;">Cobertura de seguro activa</p>
        </div>
        <div class="status-card" style="text-align: left;">
            <p style="color: var(--text-light); font-size: 0.9em;">Hospital Recomendado</p>
            <h3 style="margin: 5px 0; color: var(--text-dark); font-size: 1.3em;">Cl√≠nica Santa Fe de Bogot√°</h3>
            <p style="color: var(--text-light); font-size: 0.9em;">Motivo: Centro de trauma m√°s cercano.</p>
        </div>
        <div class="map-placeholder">
            <img src="https://placehold.co/400x200/e8e8e8/aaaaaa?text=Ruta+al+Hospital" alt="Mapa al hospital">
        </div>
        <button onclick="showModal('Navegaci√≥n Iniciada', 'Mostrando la ruta m√°s r√°pida a la Cl√≠nica Santa Fe en tu aplicaci√≥n de mapas.')">üìç VER EN EL MAPA</button>
        <button class="button secondary" onclick="navigateTo('dashboardScreen')">‚¨ÖÔ∏è VOLVER AL INICIO</button>
    </div>

    <div id="recursosScreen" class="screen">
      <div class="header">Centro de Bienestar</div>
      <ul class="resource-list">
        <li class="resource-item">
          <span class="resource-icon">üßò‚Äç‚ôÄÔ∏è</span>
          <div class="info">
            <strong>Meditaci√≥n Anti-Estr√©s</strong>
            <small>Gu√≠a de 5 minutos para calmar la mente</small>
          </div>
          <div class="actions">
            <button class="play-btn" onclick="showModal('Reproduciendo', 'Meditaci√≥n Anti-Estr√©s')">‚ñ∂Ô∏è</button>
          </div>
        </li>
        <li class="resource-item">
          <span class="resource-icon">ü´Å</span>
          <div class="info">
            <strong>Respiraci√≥n 4-7-8</strong>
            <small>T√©cnica para reducir la ansiedad</small>
          </div>
          <div class="actions">
            <button class="play-btn" onclick="showModal('Reproduciendo', 'Ejercicio de Respiraci√≥n 4-7-8')">‚ñ∂Ô∏è</button>
          </div>
        </li>
        <li class="resource-item">
          <span class="resource-icon">üéß</span>
          <div class="info">
            <strong>Sonidos de la Naturaleza</strong>
            <small>Playlist para concentraci√≥n y calma</small>
          </div>
          <div class="actions">
            <button class="play-btn" onclick="showModal('Reproduciendo', 'Playlist de Sonidos de la Naturaleza')">‚ñ∂Ô∏è</button>
          </div>
        </li>
        <li class="resource-item">
          <span class="resource-icon">üìö</span>
          <div class="info">
            <strong>Art√≠culo: Manejo del Ruido</strong>
            <small>Por: Dr. Ana Rodr√≠guez</small>
          </div>
          <div class="actions">
             <span class="premium-badge">Premium</span>
          </div>
        </li>
      </ul>
    </div>
    
    <div id="chatScreen" class="screen">
        <div class="chat-header">Asistente Virtual</div>
        <div class="chat-messages" id="chatMessages">
             <div class="chat-message bot-message">
                ¬°Hola! Soy tu asistente de bienestar. ¬øC√≥mo te sientes hoy o en qu√© puedo ayudarte?
            </div>
        </div>
        <div class="chat-input-area">
            <input type="text" id="chatInput" placeholder="Escribe tu mensaje..." onkeydown="if(event.key==='Enter') sendMessage()">
            <button id="micButton" class="chat-button" onclick="showModal('Funci√≥n de Voz', 'La entrada por micr√≥fono estar√° disponible pronto.')">üé§</button>
            <button id="sendButton" class="chat-button" onclick="sendMessage()">‚û§</button>
        </div>
    </div>

   <div id="perfilScreen" class="screen">
      <div class="header">Mi Perfil</div>
      <div class="profile-avatar" id="profileAvatar">U</div>
      <div style="text-align:center; margin-bottom:10px;">
        <h3 id="profileName" style="margin-bottom:5px;">Usuario</h3>
        <p id="profileEmail" style="font-size:0.9em; color:var(--text-light);">usuario@email.com</p>
      </div>
      
      <div class="privacy-management-section">
          <h4>Gesti√≥n de Privacidad</h4>
          <div class="setting-item">
              <div class="info">
                  <strong>Permitir ubicaci√≥n</strong>
                  <small>Para optimizar rutas y el mapa de estr√©s.</small>
              </div>
              <label class="toggle-switch"><input type="checkbox" checked><span class="slider"></span></label>
          </div>
          <div class="setting-item">
              <div class="info">
                  <strong>Datos de salud (sensores)</strong>
                  <small>Para la detecci√≥n de estr√©s en tiempo real.</small>
              </div>
              <label class="toggle-switch"><input type="checkbox" checked><span class="slider"></span></label>
          </div>
          <div class="setting-item">
              <div class="info">
                  <strong>An√°lisis an√≥nimo de IA</strong>
                  <small>Permitir que tus conversaciones an√≥nimas mejoren el asistente.</small>
              </div>
              <label class="toggle-switch"><input type="checkbox" checked><span class="slider"></span></label>
          </div>
      </div>
      
      <button class="button tertiary" style="margin-top:15px; font-size:0.9em;" onclick="showModal('Solicitud de Datos', 'Tu solicitud ha sido recibida. Recibir√°s un correo con tus datos en las pr√≥ximas 48 horas.')">Solicitar mis Datos (Portabilidad)</button>
      <button class="button danger" style="font-size:0.9em;" onclick="showModal('Eliminar Cuenta', 'Tu solicitud de eliminaci√≥n ha sido procesada. Tus datos ser√°n eliminados de forma permanente.')">Eliminar mi Cuenta y Datos</button>
      
      <button class="button secondary" onclick="logout()" style="margin-top:15px;">üö™ CERRAR SESI√ìN</button>
    </div>

    <div class="bottom-nav" id="bottomNav">
      <div class="nav-item active" data-screen="dashboardScreen" onclick="navigateTo('dashboardScreen', this)"><span class="nav-icon">üè†</span>Inicio</div>
      <div class="nav-item" data-screen="chatScreen" onclick="navigateTo('chatScreen', this)"><span class="nav-icon">üí¨</span>Asistente</div>
      <div class="nav-item" data-screen="recursosScreen" onclick="navigateTo('recursosScreen', this)"><span class="nav-icon">üßò</span>Bienestar</div>
      <div class="nav-item" data-screen="perfilScreen" onclick="navigateTo('perfilScreen', this)"><span class="nav-icon">üë§</span>Perfil</div>
    </div>
      
    <div id="appModal" class="modal-overlay">
        <div class="modal-content">
            <h3 id="modalTitle">T√≠tulo del Modal</h3>
            <p id="modalMessage">Este es un mensaje de ejemplo.</p>
            <button onclick="closeModal()">Aceptar</button>
        </div>
    </div>

  </div>

  <script>
    // --- State Management & UI Update ---
    const state = {
        currentUser: null,
        activeScreen: 'loginScreen',
        previousScreen: null
    };
    
    // --- Navigation ---
    function navigateTo(screenId, navItem = null) {
        const bottomNav = document.getElementById('bottomNav');
        
        // Hide or show nav based on the screen
        if (screenId === 'loginScreen' || screenId === 'registerScreen' || screenId === 'legalScreen') {
            bottomNav.style.display = 'none';
        } else {
            bottomNav.style.display = 'flex';
        }

        // Switch screens
        if(state.activeScreen !== screenId) {
            state.previousScreen = state.activeScreen;
        }
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        const targetScreen = document.getElementById(screenId);
        if (targetScreen) {
            targetScreen.classList.add('active');
            state.activeScreen = screenId;
        }

        // Update nav item active state
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        let activeNavItem = navItem;
        if (!activeNavItem) {
             activeNavItem = document.querySelector(`.nav-item[data-screen="${screenId}"]`);
        }
        
        if (screenId === 'sosScreen' || screenId === 'sugerenciaHospitalScreen') {
             const viajeNavItem = document.querySelector('.nav-item[data-screen="enViajeScreen"]');
             if(viajeNavItem) viajeNavItem.classList.add('active');
        } else if (activeNavItem) {
            activeNavItem.classList.add('active');
        }
    }

    // --- User Authentication ---
    function login() {
        const email = document.getElementById("email").value;
        const password = document.getElementById("password").value;
        if (email && password) {
            state.currentUser = { email: email };
            updateProfileUI(email);
            navigateTo('dashboardScreen', document.querySelector('.nav-item[data-screen="dashboardScreen"]'));
        } else {
            showModal('Error de Inicio de Sesi√≥n', 'Por favor, ingresa tu correo y contrase√±a para continuar.');
        }
    }

    // ==========================================================
    // === L√≥gica para la nueva pantalla de registro y T&C ======
    // ==========================================================
    function createAccount() {
        const email = document.getElementById('registerEmail').value;
        const password = document.getElementById('registerPassword').value;
        const birthdate = document.getElementById('birthdate').value;
        const acceptTerms = document.getElementById('acceptTerms').checked;
        const acceptPrivacy = document.getElementById('acceptPrivacy').checked;

        // Validation
        if (!email || !password || !birthdate) {
            showModal('Campos Incompletos', 'Por favor, rellena todos los campos para crear tu cuenta.');
            return;
        }

        const age = new Date().getFullYear() - new Date(birthdate).getFullYear();
        const m = new Date().getMonth() - new Date(birthdate).getMonth();
        if (m < 0 || (m === 0 && new Date().getDate() < new Date(birthdate).getDate())) {
            age--;
        }

        if (age < 18) {
            showModal('Verificaci√≥n de Edad', 'Debes ser mayor de 18 a√±os para utilizar esta aplicaci√≥n.');
            return;
        }

        if (!acceptTerms || !acceptPrivacy) {
            showModal('Consentimiento Requerido', 'Debes aceptar los T√©rminos y Condiciones y la Pol√≠tica de Privacidad para continuar.');
            return;
        }

        // --- Simulaci√≥n de creaci√≥n de cuenta ---
        console.log('Cuenta creada para:', email);
        state.currentUser = { email: email };
        updateProfileUI(email);
        navigateTo('dashboardScreen', document.querySelector('.nav-item[data-screen="dashboardScreen"]'));
    }

    function showLegal(type) {
        const legalTitle = document.getElementById('legalTitle');
        const legalContent = document.getElementById('legalContent');
        let titleText = '';
        let contentHTML = '';

        if (type === 'terms') {
            titleText = 'T√©rminos y Condiciones';
            contentHTML = `
                <h3>1. Aceptaci√≥n de los T√©rminos</h3>
                <p>Al crear una cuenta y utilizar la aplicaci√≥n "Bogot√° Tranquila", usted acepta y se compromete a cumplir con los presentes T√©rminos y Condiciones. Si no est√° de acuerdo, no debe utilizar la aplicaci√≥n.</p>
                <h3>2. Uso del Servicio</h3>
                <p>El servicio est√° destinado a mayores de 18 a√±os. Usted se compromete a no utilizar la aplicaci√≥n para fines ilegales. Las sugerencias de bienestar proporcionadas por la IA no constituyen un consejo m√©dico profesional.</p>
                <h3>3. Propiedad Intelectual</h3>
                <p>Todo el contenido de la aplicaci√≥n es propiedad de los desarrolladores del proyecto.</p>
            `;
        } else if (type === 'privacy') {
            titleText = 'Pol√≠tica de Privacidad';
            contentHTML = `
                <p>En "Bogot√° Tranquila", su confianza es nuestra prioridad. Esta pol√≠tica detalla c√≥mo manejamos sus datos, en cumplimiento con la <strong>Ley 1581 de 2012 de Colombia</strong>.</p>
                <h3>1. Datos que Recopilamos</h3>
                <p>Para ofrecer un servicio personalizado, recopilamos: (a) Datos de registro (correo, fecha de nacimiento), (b) Datos de uso y ubicaci√≥n durante los viajes, (c) Datos de sensores (con su permiso expl√≠cito), y (d) Conversaciones con el asistente.</p>
                <h3>2. Uso de la Informaci√≥n</h3>
                <p>Sus datos se utilizan para: personalizar su experiencia, potenciar las respuestas del asistente de IA, y generar el mapa de estr√©s urbano. <strong>Su bienestar es el √∫nico objetivo.</strong></p>
                <h3>3. Anonimizaci√≥n y Entrenamiento de IA</h3>
                <p>Para mejorar nuestros modelos de IA (detecci√≥n de estr√©s y an√°lisis de patrones), utilizamos sus datos de conversaci√≥n y de sensores de forma <strong>totalmente an√≥nima y agregada</strong>. Se elimina cualquier informaci√≥n que pueda identificarle, garantizando su privacidad absoluta en los an√°lisis.</p>
            `;
        }
        
        legalTitle.textContent = titleText;
        legalContent.innerHTML = contentHTML;
        navigateTo('legalScreen');
    }

    function logout() {
        state.currentUser = null;
        navigateTo('loginScreen');
        // Clear user info from UI
        document.getElementById('email').value = "usuario@email.com";
        document.getElementById('password').value = "‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢";
    }

    function updateProfileUI(email) {
        const name = email.split('@')[0].replace(/[\.\_]/g, ' ');
        const capitalizedName = name.charAt(0).toUpperCase() + name.slice(1);
        document.getElementById('userName').textContent = capitalizedName;
        document.getElementById('profileName').textContent = capitalizedName;
        document.getElementById('profileEmail').textContent = email;
        document.getElementById('profileAvatar').textContent = capitalizedName.charAt(0);
    }
    
    // --- Modal System ---
    const modal = document.getElementById('appModal');
    const modalTitle = document.getElementById('modalTitle');
    const modalMessage = document.getElementById('modalMessage');

    function showModal(title, message) {
        modalTitle.textContent = title;
        modalMessage.textContent = message;
        modal.classList.add('active');
    }

    function closeModal() {
        modal.classList.remove('active');
    }

    // --- Chat Assistant Logic ---
    const chatMessages = document.getElementById('chatMessages');
    const chatInput = document.getElementById('chatInput');

    function sendMessage() {
        const messageText = chatInput.value.trim();
        if (messageText === '') return;

        appendMessage(messageText, 'user');
        chatInput.value = '';

        setTimeout(() => {
            showTypingIndicator();
            setTimeout(() => {
                removeTypingIndicator();
                const botResponse = getBotResponse(messageText);
                appendMessage(botResponse, 'bot');
            }, 1200 + Math.random() * 500);
        }, 300);
    }

    function appendMessage(text, type) {
        const messageDiv = document.createElement('div');
        messageDiv.classList.add('chat-message', `${type}-message`);
        messageDiv.textContent = text;
        chatMessages.appendChild(messageDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight; // Auto-scroll
    }
    
    function showTypingIndicator() {
        const typingDiv = document.createElement('div');
        typingDiv.classList.add('chat-message', 'bot-message', 'typing');
        typingDiv.id = 'typing-indicator';
        typingDiv.textContent = 'Escribiendo...';
        chatMessages.appendChild(typingDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function removeTypingIndicator() {
        const indicator = document.getElementById('typing-indicator');
        if (indicator) {
            indicator.remove();
        }
    }
    
    function getBotResponse(userInput) {
        const lcInput = userInput.toLowerCase();
        if (lcInput.includes('estr√©s') || lcInput.includes('estresado') || lcInput.includes('ansiedad')) {
            return "Entiendo que te sientas as√≠. A veces, tomarse un momento para una respiraci√≥n profunda puede ayudar mucho. ¬øTe gustar√≠a que te gu√≠e en un ejercicio de respiraci√≥n?";
        } else if (lcInput.includes('tr√°fico') || lcInput.includes('tranc√≥n')) {
            return "El tr√°fico en Bogot√° puede ser abrumador. Recuerda que tu seguridad y calma son lo m√°s importante. ¬øHas probado escuchar algo de m√∫sica relajante? Puedo sugerirte una playlist desde la secci√≥n de Bienestar.";
        } else if (lcInput.includes('gracias')) {
            return "¬°De nada! Estoy aqu√≠ para ayudarte a tener un d√≠a m√°s tranquilo. ¬øHay algo m√°s que pueda hacer por ti?";
        } else if (lcInput.includes('hola') || lcInput.includes('buenos dias')) {
            return "¬°Hola! Qu√© bueno hablar contigo. ¬øEn qu√© te puedo ayudar para mejorar tu bienestar hoy?";
        } else {
            return "Gracias por compartir eso conmigo. Estoy aqu√≠ para escucharte. Recuerda que en la secci√≥n de 'Bienestar' tienes recursos que podr√≠an ayudarte a sentirte mejor.";
        }
    }
	
	
	
    function updateProfileUI(email) {
        state.currentUser = { email };
        const name = email.split('@')[0].replace(/[\.\_]/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
        document.getElementById('userName').textContent = name;
        document.getElementById('profileName').textContent = name;
        document.getElementById('profileEmail').textContent = email;
        document.getElementById('profileAvatar').textContent = name.charAt(0);
    }

    // --- Legal, Onboarding & Chat Logic ---
    function showLegal(type) {
        const content = {
            terms: { 
                title: 'T√©rminos y Condiciones', 
                body: '<h3>1. Aceptaci√≥n de los T√©rminos</h3><p>Al crear una cuenta y utilizar la aplicaci√≥n "Bogot√° Tranquila", usted acepta y se compromete a cumplir con los presentes T√©rminos y Condiciones. Si no est√° de acuerdo, no debe utilizar la aplicaci√≥n.</p><h3>2. Uso del Servicio</h3><p>El servicio est√° destinado a mayores de 18 a√±os. Las sugerencias de bienestar proporcionadas por la IA no constituyen un consejo m√©dico profesional.</p>' 
            },
            privacy: { 
                title: 'Pol√≠tica de Privacidad', 
                body: `<p>En "Bogot√° Tranquila", su confianza es nuestra prioridad. Esta pol√≠tica detalla c√≥mo manejamos sus datos, en cumplimiento con la <strong>Ley 1581 de 2012 de Colombia</strong>.</p><h3>1. Datos que Recopilamos</h3><p>Recopilamos: datos de registro, ubicaci√≥n, datos de sensores (con su permiso expl√≠cito), y conversaciones con el asistente.</p><h3>2. Uso y Anonimizaci√≥n de Datos</h3><p>Sus datos se utilizan para personalizar su experiencia y para entrenar nuestros modelos de IA de forma <strong>totalmente an√≥nima y agregada</strong>, garantizando su privacidad.</p>` 
            }
        };
        document.getElementById('legalTitle').textContent = content[type].title;
        document.getElementById('legalContent').innerHTML = content[type].body;
        navigateTo('legalScreen');
    }

    function showOnboardingSlide(step) {
        document.querySelectorAll('.onboarding-slide').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.dot').forEach(d => d.classList.remove('active'));
        
        document.getElementById(`onboarding-slide-${step}`)?.classList.add('active');
        document.getElementById(`dot-${step}`)?.classList.add('active');
    }

    function onboardingNext() {
        state.onboardingStep++;
        if (state.onboardingStep > 3) {
            navigateTo('dashboardScreen', document.querySelector('.nav-item[data-screen="dashboardScreen"]'));
            return;
        }
        showOnboardingSlide(state.onboardingStep);
        if (state.onboardingStep === 3) {
            document.getElementById('onboardingNextBtn').textContent = "FINALIZAR";
        }
    }

    // Close modal if user clicks on the overlay
    modal.addEventListener('click', (event) => {
        if (event.target === modal) {
            closeModal();
        }
    });

    // Initial setup
    document.addEventListener('DOMContentLoaded', () => {
        navigateTo('loginScreen');
    });
  </script>
</body>
</html>